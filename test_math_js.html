<!DOCTYPE html>
<html>
<head>
    <title>Test Math Renderer Fix</title>
</head>
<body>
    <h1>Testing Math LaTeX Fix</h1>
    <div id="test-content">
        <p>The result is (10 \div 2) which equals 5.</p>
        <p>We calculate (a \times b) and check if (x \ne y).</p>
        <p>Regular math (10 + 2) should not change.</p>
    </div>
    
    <h2>Test Results:</h2>
    <div id="results"></div>

    <script>
// Copy the FIXED SimpleMathRenderer code from simple_math_renderer.py
window.SimpleMathRenderer = {
    // Map of common LaTeX symbols to Unicode
    symbols: {
        // Single backslash patterns (most common)
        '\\\\times': '√ó',
        '\\\\cdot': '¬∑',
        '\\\\div': '√∑',
        '\\\\pm': '¬±',
        '\\\\mp': '‚àì',
        '\\\\leq': '‚â§',
        '\\\\geq': '‚â•',
        '\\\\neq': '‚â†',
        '\\\\ne': '‚â†',
        '\\\\approx': '‚âà',
        '\\\\sim': '‚àº',
        '\\\\equiv': '‚â°',
        '\\\\propto': '‚àù',
        '\\\\infty': '‚àû',
        '\\\\alpha': 'Œ±',
        '\\\\beta': 'Œ≤',
        '\\\\gamma': 'Œ≥',
        '\\\\delta': 'Œ¥',
        '\\\\epsilon': 'Œµ',
        '\\\\theta': 'Œ∏',
        '\\\\lambda': 'Œª',
        '\\\\mu': 'Œº',
        '\\\\pi': 'œÄ',
        '\\\\sigma': 'œÉ',
        '\\\\phi': 'œÜ',
        '\\\\omega': 'œâ',
        '\\\\Gamma': 'Œì',
        '\\\\Delta': 'Œî',
        '\\\\Theta': 'Œò',
        '\\\\Lambda': 'Œõ',
        '\\\\Sigma': 'Œ£',
        '\\\\Phi': 'Œ¶',
        '\\\\Omega': 'Œ©',
        // Also handle single backslash patterns
        '\\times': '√ó',
        '\\cdot': '¬∑',
        '\\div': '√∑',
        '\\pm': '¬±',
        '\\mp': '‚àì',
        '\\leq': '‚â§',
        '\\geq': '‚â•',
        '\\neq': '‚â†',
        '\\ne': '‚â†',
        '\\approx': '‚âà',
        '\\sim': '‚àº',
        '\\equiv': '‚â°',
        '\\propto': '‚àù',
        '\\infty': '‚àû',
        '\\alpha': 'Œ±',
        '\\beta': 'Œ≤',
        '\\gamma': 'Œ≥',
        '\\delta': 'Œ¥',
        '\\epsilon': 'Œµ',
        '\\theta': 'Œ∏',
        '\\lambda': 'Œª',
        '\\mu': 'Œº',
        '\\pi': 'œÄ',
        '\\sigma': 'œÉ',
        '\\phi': 'œÜ',
        '\\omega': 'œâ',
        '\\Gamma': 'Œì',
        '\\Delta': 'Œî',
        '\\Theta': 'Œò',
        '\\Lambda': 'Œõ',
        '\\Sigma': 'Œ£',
        '\\Phi': 'Œ¶',
        '\\Omega': 'Œ©'
    },
    
    // Render simple math expressions
    renderExpression: function(latex) {
        let result = latex;
        
        // Replace symbols
        for (let symbol in this.symbols) {
            result = result.replace(new RegExp(symbol, 'g'), this.symbols[symbol]);
        }
        
        // Handle fractions (simple case: \\frac{a}{b})
        result = result.replace(/\\\\frac\s*\{([^}]+)\}\s*\{([^}]+)\}/g, function(match, num, den) {
            return '<span style="display: inline-block; vertical-align: middle;"><span style="display: block; text-align: center; border-bottom: 1px solid; padding: 0 4px;">' + num + '</span><span style="display: block; text-align: center; padding: 0 4px;">' + den + '</span></span>';
        });
        
        // Handle superscripts (simple case: ^{n} or ^n)
        result = result.replace(/\^(\{[^}]+\}|\w)/g, function(match, exp) {
            let cleanExp = exp.replace(/[{}]/g, '');
            return '<sup>' + cleanExp + '</sup>';
        });
        
        // Handle subscripts (simple case: _{n} or _n)
        result = result.replace(/_(\{[^}]+\}|\w)/g, function(match, sub) {
            let cleanSub = sub.replace(/[{}]/g, '');
            return '<sub>' + cleanSub + '</sub>';
        });
        
        // Handle square roots (simple case: \\sqrt{expression})
        result = result.replace(/\\\\sqrt\s*\{([^}]+)\}/g, function(match, expr) {
            return '‚àö(' + expr + ')';
        });
        
        // Clean up remaining backslashes and spaces
        result = result.replace(/\\\\/g, '');
        result = result.replace(/\\/g, ''); // Also clean single backslashes
        result = result.replace(/\s+/g, ' ');
        
        return result;
    },
    
    // Process all math expressions on the page
    processPage: function(options = {}) {
        const doc = options.context || document;
        const displayStyle = options.displayStyle || 'display: block; text-align: center; margin: 10px 0; font-style: italic; font-weight: bold;';
        const inlineStyle = options.inlineStyle || 'font-style: italic; color: blue; font-weight: bold;';
        
        console.log('Processing page with SimpleMathRenderer...');
        
        // Find all display math [expression]
        let displayMath = doc.querySelectorAll('p, div, span');
        displayMath.forEach(function(element) {
            let content = element.innerHTML;
            if (content.includes('[') && content.includes(']')) {
                // Replace display math expressions
                content = content.replace(/\[([^[\]]+)\]/g, function(match, expr) {
                    if (!expr.includes('\\')) return match; // Return original if no LaTeX commands
                    let rendered = SimpleMathRenderer.renderExpression(expr);
                    return '<span style="' + displayStyle + '">' + rendered + '</span>';
                });
                element.innerHTML = content;
            }
            
            // Replace inline math expressions (expression)
            content = element.innerHTML;
            if (content.includes('(') && content.includes(')')) {
                content = content.replace(/\(([^()]*\\[^()]*)\)/g, function(match, expr) {
                    if (expr.includes('\\')) { // Only process if it contains LaTeX
                        let rendered = SimpleMathRenderer.renderExpression(expr);
                        return '<span style="' + inlineStyle + '">' + rendered + '</span>';
                    }
                    return match;
                });
                element.innerHTML = content;
            }
        });
        
        console.log('SimpleMathRenderer processing completed');
    }
};

// Test function
function runTests() {
    const testDiv = document.getElementById('test-content');
    const resultsDiv = document.getElementById('results');
    
    // Show before
    resultsDiv.innerHTML = '<h3>Before Processing:</h3><pre>' + testDiv.innerHTML + '</pre>';
    
    // Process the math
    SimpleMathRenderer.processPage();
    
    // Show after
    resultsDiv.innerHTML += '<h3>After Processing:</h3><pre>' + testDiv.innerHTML + '</pre>';
    
    // Check if the fix worked
    const processedContent = testDiv.innerHTML;
    const hasRenderedDiv = processedContent.includes('√∑');
    const hasRenderedTimes = processedContent.includes('√ó');
    const hasRenderedNe = processedContent.includes('‚â†');
    
    resultsDiv.innerHTML += '<h3>Test Results:</h3>';
    resultsDiv.innerHTML += '<p>' + (hasRenderedDiv ? '‚úÖ' : '‚ùå') + ' \\div rendered as √∑</p>';
    resultsDiv.innerHTML += '<p>' + (hasRenderedTimes ? '‚úÖ' : '‚ùå') + ' \\times rendered as √ó</p>';
    resultsDiv.innerHTML += '<p>' + (hasRenderedNe ? '‚úÖ' : '‚ùå') + ' \\ne rendered as ‚â†</p>';
    
    if (hasRenderedDiv && hasRenderedTimes && hasRenderedNe) {
        resultsDiv.innerHTML += '<p style="color: green; font-weight: bold;">üéâ All tests passed! The fix is working!</p>';
    } else {
        resultsDiv.innerHTML += '<p style="color: red; font-weight: bold;">‚ùå Some tests failed. The fix needs more work.</p>';
    }
}

// Run tests when page loads
window.addEventListener('load', runTests);
    </script>
</body>
</html>